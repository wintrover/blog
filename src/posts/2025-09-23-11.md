---
title: "얼굴 인식 시스템 개선기: DeepFace에서 InsightFace로, 품질·성능·운영까지 한 걸음"
date: 2025-09-23 00:00:00 -0000
tags: kyc face-recognition insightface deepface gpu batching docker sonarqube solid ci lint lfw wandb react fastapi benchmarking
category: Company Work
excerpt: "DeepFace에서 InsightFace로 전환해 배치 처리로 성능을 끌어올리고, SonarQube·SOLID·CI·Docker(GPU)로 품질과 운영을 정비했습니다. LFW 벤치마크와 W&B로 성능을 시각화하고, React-백엔드 연동 과정의 이슈도 해결했습니다."
---

## 배경
KYC 실명인증 흐름에서 얼굴 인식은 정확도와 처리량이 모두 중요한 병목입니다. 초기에는 DeepFace로 시작했지만, GPU 활용과 동시 처리 측면에서 한계를 마주하며 전면적인 개선을 진행했습니다.

## 1) 얼굴 인식 시스템 개선: DeepFace → InsightFace
- 전환 이유: DeepFace는 GPU 병렬 처리와 대량 이미지 동시 처리에서 제약이 있었고, 실서비스 요구 TPS를 안정적으로 만족시키기 어려웠습니다.
- 해결: InsightFace로 전환하여 배치 처리(batched inference)와 효율적인 GPU 사용을 구현했습니다. 다중 이미지 동시 추론을 표준화해 처리량(throughput)을 체계적으로 끌어올렸습니다.
- 결과: 동일한 리소스에서 더 낮은 지연(latency)과 높은 처리량을 확보, 피크 트래픽에서도 안정적인 응답을 유지했습니다.

## 2) 개발 환경 및 코드 품질 관리
- 마이그레이션 실패 원인을 코드 품질 이슈로 규정하고, SonarQube를 도입해 코드 스멜·버그·취약점을 체계적으로 제거했습니다.
- SOLID 원칙을 기준으로 의존성 역전, 인터페이스 분리, 단일 책임을 적용해 서비스·리포지토리·게이트웨이 레이어를 재정비했습니다.
- Docker 기반으로 GPU 가속 런타임을 표준화하여 개발/테스트/배포 환경 간 일관성을 확보했습니다.
- CI 파이프라인에 린팅·정적 분석·간단한 테스트를 자동화해, 변경마다 품질 게이트를 통과하도록 워크플로우를 개선했습니다.

## 3) 성능 검증 및 시각화: LFW 벤치마크 + W&B
- 벤치마크: LFW(Labeled Faces in the Wild) 데이터셋으로 정확도(Accuracy), AUC 등 핵심 지표를 산출하는 벤치마크를 구축했습니다.
- 문제와 해결: 초기엔 평가 파이프라인 오류로 지표가 불안정했으나, 로깅·디버깅 체계를 정비하고 파이프라인을 안정화했습니다.
- 시각화: W&B(Weights & Biases)를 도입해 실험별 지표, 파라미터, 모델 버전을 대시보드로 관리하고 추세를 시각적으로 확인할 수 있게 했습니다.

## 4) 서비스 연동 준비: React + FastAPI
- 연동 작업을 시작하며 이미지 업로드 API 버그, 타입 불일치 등 여러 문제를 해결했습니다.
- 프론트엔드(React)와 백엔드(FastAPI) 간 데이터 계약을 명확히 하고, 실패 케이스(업로드 중단, 타입 오류 등)에 대한 예외 흐름을 정리해 안정적인 통신 기반을 마련했습니다.

## 회고와 다음 단계
- 전환의 핵심은 “성능을 수치로 검증하고, 품질을 프로세스로 보장하는 것”이었습니다. InsightFace 기반 배치 추론과 품질 게이트가 이를 가능하게 했습니다.
- 다음 단계로는 대규모 배치·스트리밍 처리 시나리오에서의 스케일 아웃, 추론 캐시·온디맨드 최적화, 그리고 사용자 지표 기반의 모델/파이프라인 개선을 계획하고 있습니다.